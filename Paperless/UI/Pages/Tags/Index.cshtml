@page
@model TagsIndexModel
@{
    ViewData["Title"] = "Tags Management";
}
<div class="container-fluid bg-dark text-light min-vh-100">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="py-4">Tags Management</h1>
            <button class="btn btn-success" onclick="showCreateTagModal()">Create New Tag</button>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div class="card bg-secondary">
                <div class="card-body">
                    <h5 class="card-title">All Tags</h5>
                    <div id="tagsList" class="row g-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Tag Modal -->
<div class="modal fade" id="tagModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-light">
            <div class="modal-header">
                <h5 class="modal-title" id="tagModalTitle">Create Tag</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="tagForm">
                    <div class="mb-3">
                        <label for="tagName" class="form-label">Tag Name</label>
                        <input type="text" class="form-control bg-dark text-light" id="tagName" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveTag()">Save Tag</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentTagId = null;

async function loadTags() {
    try {
        const res = await fetch('http://localhost:8085/api/tag');
        const tags = await res.json();
        const container = document.getElementById('tagsList');
        container.innerHTML = tags.map(tag => `
            <div class='col-md-4'>
                <div class='card bg-dark text-light'>
                    <div class='card-body'>
                        <h6 class='card-title'>${tag.name}</h6>
                        <div class='d-flex gap-2'>
                            <button class='btn btn-outline-warning btn-sm' onclick='editTag(${tag.id}, "${tag.name}")'>Edit</button>
                            <button class='btn btn-outline-danger btn-sm' onclick='deleteTag(${tag.id})'>Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error loading tags:', error);
        document.getElementById('tagsList').innerHTML = '<div class="col-12"><p class="text-danger">Error loading tags</p></div>';
    }
}

function showCreateTagModal() {
    currentTagId = null;
    document.getElementById('tagModalTitle').textContent = 'Create Tag';
    document.getElementById('tagName').value = '';
    new bootstrap.Modal(document.getElementById('tagModal')).show();
}

function editTag(id, name) {
    currentTagId = id;
    document.getElementById('tagModalTitle').textContent = 'Edit Tag';
    document.getElementById('tagName').value = name;
    new bootstrap.Modal(document.getElementById('tagModal')).show();
}

async function saveTag() {
    const name = document.getElementById('tagName').value.trim();
    if (!name) return;
    
    try {
        const url = currentTagId 
            ? `http://localhost:8085/api/tag/${currentTagId}`
            : 'http://localhost:8085/api/tag';
        
        const method = currentTagId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: currentTagId || 0,
                name: name
            })
        });
        
        if (response.ok) {
            bootstrap.Modal.getInstance(document.getElementById('tagModal')).hide();
            loadTags();
        } else {
            alert('Error saving tag');
        }
    } catch (error) {
        console.error('Error saving tag:', error);
        alert('Error saving tag');
    }
}

async function deleteTag(id) {
    if (!confirm('Are you sure you want to delete this tag?')) return;
    
    try {
        const response = await fetch(`http://localhost:8085/api/tag/${id}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            loadTags();
        } else {
            alert('Error deleting tag');
        }
    } catch (error) {
        console.error('Error deleting tag:', error);
        alert('Error deleting tag');
    }
}

loadTags();
</script>

<style>
body, .container-fluid { background: #222 !important; }
.card { border-radius: 12px; }
.modal-content { border: 1px solid #444; }
</style>
